<!-- Load static files -->
{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@700&display=swap" rel="stylesheet"/>
  <title>Workout App</title>

  <style>
    body {
      margin: 0;
      font-family: 'Roboto', sans-serif;
      background-color: #f4f4f4;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #003366;
      padding: 20px 40px;
    }
    .logo {
      color: white;
      font-size: 32px;
      text-decoration: none;
    }
    nav ul {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
    }
    nav li {
      margin-left: 30px;
    }
    nav a {
      color: white;
      text-decoration: none;
      padding: 15px;
      font-size: 18px;
      transition: background-color 0.3s, transform 0.3s;
    }
    nav a:hover {
      background-color: #007BFF;
      transform: scale(1.05);
    }

    .container {
      padding: 20px;
    }
    .main-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      text-align: center;
      margin-bottom: 20px;
    }
    .main-section img {
      max-width: 100%;
      border-radius: 8px;
      margin-bottom: 15px;
    }
    .workout-today,
    .progress {
      background: white;
      padding: 20px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .workout-today h2,
    .progress h2 {
      margin-top: 0;
    }
    .cta-button {
      display: inline-block;
      padding: 10px 20px;
      background: #007BFF;
      color: white;
      border-radius: 5px;
      text-decoration: none;
      transition: background-color 0.3s;
    }
    .cta-button:hover {
      background: #0056B3;
    }

    /* Calendar grid */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 10px;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .calendar h2 {
      grid-column: span 7;
      text-align: center;
      margin-top: 0;
    }
    .day-header {
      font-weight: bold;
      background: #003366;
      color: white;
      padding: 10px;
      text-align: center;
      border-radius: 5px;
    }
    .day {
      border: 1px solid #ddd;
      min-height: 100px;
      padding: 5px;
      border-radius: 5px;
    }
    .workout {
      margin: 5px 0;
      padding: 3px 6px;
      border-radius: 4px;
      background: #007BFF;
      color: white;
    }
    .workout.completed {
      background: #28A745;
    }
  </style>
</head>

<body>
    <header>
        <a class="logo" href="{% url 'home' %}">Workout App</a>
        <nav>
            <ul>
                {% if user.is_authenticated %}
                    <li><a href="{% url 'generate_workout' %}">Generate Workout</a></li>
                    <li><a href="{% url 'calendar' %}">Calendar</a></li>
                    <li><a href="{% url 'goals:goals' %}">Goals</a></li>
                    <li><a href="{% url 'user_data' %}">Account</a></li>
                    <li><a href="{% url 'logout' %}">Logout</a></li>
                {% else %}
                <li><a href="{% url 'login' %}">Login</a></li>
                <li><a href="{% url 'register' %}">Register</a></li>
                {% endif %}
            </ul>
        </nav>
    </header>
    
    <div class="container">
        <div class="main-section">
            <h1>Welcome to Your Workout Journey!</h1>
            <img src="{% static 'images/fitness_pic.jpg' %}" alt="Person Getting Ready to Deadlift" style="max-width: 40%; height: auto;">
            <p>Join us in achieving your fitness goals with personalized workout plans, progress tracking, and a supportive community. Let's get started!</p>
        </div>

        {% if user.is_authenticated %}
        <div class="welcome">Welcome back, {{ user.username }}!</div>
        <!-- <div class="workout-today">
          <h2>Today's Workout</h2>
          <p>Exercise: <strong>Full Body Strength Training</strong></p>
          <p>Duration: <strong>45 minutes</strong></p>
          <a href="#start-workout" class="cta-button">Start Workout</a>
        </div> -->

        <!-- Dynamic Workout Calendar -->
        <div class="calendar" id="calendar">
          <h2>Upcoming Week</h2>
          <div class="day-header">Mon</div>
          <div class="day-header">Tue</div>
          <div class="day-header">Wed</div>
          <div class="day-header">Thu</div>
          <div class="day-header">Fri</div>
          <div class="day-header">Sat</div>
          <div class="day-header">Sun</div>
        </div>


        <div class="progress">
          <h2>Current Goals</h2>
          <ul>
            {% for goal in goals %}
              <li>{{ goal.name }}</li>
            {% empty %}
              <li>No goals found.</li>
            {% endfor %}
          </ul>
        </div>
  
        <div class="progress">
          <h2>Your Progress</h2>
          <p>
            You've completed
            <strong id="percent-text">0%</strong>
            of your sets this month!
          </p>
          <div style="background:#e0e0e0; border-radius:5px; overflow:hidden;">
            <div
              id="progress-bar-fill"
              style="width:0%; height:20px; background:#007BFF;"
            ></div>
          </div>
        </div>
      {% else %}
        <div class="welcome">Welcome to the Workout App! Please log in or register to get started.</div>
      {% endif %}
        
        <!-- Month Progress bar script -->
        <script>
          document.addEventListener("DOMContentLoaded", () => {
            const today = new Date();
          
            // 1. Compute the window for THIS month:
            const startOfThisMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            const startOfNextMonth = new Date(today.getFullYear(), today.getMonth() + 1, 1);
            console.log("This‑month window:", startOfThisMonth, "→", startOfNextMonth);
          
            // 2. Fetch your workout_events JSON
            fetch("{% url 'workout_events' %}")
              .then(res => res.json())
              .then(events => {
                console.log("All events:", events);
          
                // 3. Keep only events in [startOfThisMonth, startOfNextMonth)
                const thisMonthEvents = events.filter(ev => {
                  const ts = new Date(ev.start).getTime();
                  return ts >= startOfThisMonth.getTime() && ts < startOfNextMonth.getTime();
                });
                console.log("This‑month events:", thisMonthEvents);
          
                // 4. Count total vs. completed
                const total = thisMonthEvents.length;
                const done  = thisMonthEvents.filter(ev => ev.completed).length;
                console.log(`Total: ${total}, Completed: ${done}`);
          
                // 5. Compute percentage and clamp at 100%
                const pct = total ? Math.min(100, Math.round((done / total) * 100)) : 0;
                console.log("Computed percent:", pct);
          
                // 6. Render into your DOM
                document.getElementById("percent-text").textContent = pct + "%";
                document.getElementById("progress-bar-fill").style.width = pct + "%";
              })
              .catch(err => console.error("Error loading events:", err));
          });
          </script>
          



    </div>
   
            <!-- Current week workouts script -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
  
        fetch("{% url 'workout_events' %}")
          .then(r => r.json())
          .then(events => {
            // group by date
            const eventsByDate = {};
            events.forEach(e => {
              eventsByDate[e.start] = eventsByDate[e.start] || [];
              eventsByDate[e.start].push(e);
            });
  
                        /// compute this week’s Monday
            const today = new Date();
            const dow   = today.getDay();            // 0=Sun … 6=Sat
            const daysSinceMon = (dow + 6) % 7;      // Sun→6, Mon→0, Tue→1, …, Sat→5
            const weekStart = new Date(today);
            weekStart.setDate(today.getDate() - daysSinceMon);
            weekStart.setHours(0,0,0,0);
  
  
            const cal = document.getElementById('calendar');
            for (let i = 0; i < 7; i++) {
              const dt = new Date(weekStart);
              dt.setDate(weekStart.getDate() + i);
              const iso = dt.toISOString().slice(0,10);
  
              const dayCell = document.createElement('div');
              dayCell.className = 'day';
  
              if (eventsByDate[iso]) {
                eventsByDate[iso].forEach(e => {
                  const w = document.createElement('div');
                  w.className = 'workout' + (e.completed ? ' completed' : '');
                  w.textContent = e.title + (e.completed ? ' ✔️' : '');
                  dayCell.appendChild(w);
                });
              } else {
                const rest = document.createElement('div');
                rest.className = 'workout';
                rest.textContent = 'Rest Day';
                dayCell.appendChild(rest);
              }
  
              cal.appendChild(dayCell);
            }
          })
          .catch(err => {
            console.error(err);
            const cal = document.getElementById('calendar');
            cal.insertAdjacentHTML('beforeend', 
              '<div class="day" style="grid-column: span 7; text-align:center;">Could not load workouts.</div>'
            );
          });
      });
    </script>
  
</body>

</html>